/*! glQuery.js - v0.1.0 - 2013-11-22
* https://github.com/gruntjs/grunt-init-jquery-sample
* Copyright (c) 2013 Jan Jansen; Licensed MIT */
(function(e,t,i,a){e.camera={lookAt:[],eye:[],cameraMatrix:function(t){return t&&(this.perspective.Matrix=i.create(),this.perspective.Matrix=i.perspective(60,e.canvasWidth/e.canvasHeight,.1,100,this.perspective.Matrix)),this.perspective.Matrix},add:function(e,t,i,r,n){a.log(e),a.log(t),a.log(i),a.log(r),a.log(n)},createLookAtByMvMatrix:function(e){var a=t.create([0,0,-1]),r=t.create([0,1,0]);this.eye=t.create([0,0,0]);var n=i.create();return a=t.normalize(i.multiplyVec3(e,a)),r=r,this.eye=i.multiplyVec3(e,this.eye),n=i.lookAt(this.eye,a,r,n),this.lookAt=n,n},uniformCamera:function(t){e.gl.uniformMatrix4fv(t.uniforms.common_vertex.uPerspectiveMatrix.location,!1,this.cameraMatrix()),e.gl.uniformMatrix4fv(t.uniforms.common_vertex.uLookAt.location,!1,this.lookAt)}}})(glQuery,vec3,mat4,console),function(e){e.camera.orthographic={}}(glQuery),function(e){e.camera.perspective={Matrix:[]}}(glQuery),function(e,t){e.action={createActionHandler:function(e,t,i){return this.actionHandler(i,{data:t,action:e}),!0},actionHandler:function(e,t){return this.task[t.action](e,t),!0},task:{translatePosition:function(t,i){e.event.trigger("move",t,!0,i);for(var a=0;t.length>a;a++)e.object.objects[t[a]].translateVec3ObjectPos(i);return!0},setPosition:function(t,i){e.event.trigger("move",t,!0,i);for(var a=0;t.length>a;a++)e.object.objects[t[a]].setVec3ObjectPos(i)},rotate:function(){},rotateX:function(){},rotateY:function(){},rotateZ:function(){},trackTo:function(e,i){t.log(e),t.log(i)},lookAt:function(e,i){t.log(e),t.log(i)}}}}(glQuery,console),function(e,t){e.animation={createAnimationHandler:function(e,i,a,r,n){n||"function"!=typeof r||(n=r,r=null),n||"string"!=typeof r||(n=null),"string"==typeof a&&(r=a,a=t),"function"==typeof a&&(n=a,a=t),i={data:i,during:a,easing:r,callback:n};for(var o=0;e.length>o;o++)this.animationHandler(e[o],i)},animationHandler:function(t,i){e.event.trigger(i.data.action,t,!0,i),e.fx.custom(t,i)}},e.fx={custom:function(e,t){this.startTime=(new Date).getTime();var i=this.getFrom[t.data.action](e),a=t.data.end;this.now=this.startTime;var r=0,n=t.data.action;this.duration=t.during||this.speeds._default;var o=13/this.duration;this.step(e,n,i,a,r,o,this,t.callback,t.data,!1)},speeds:{slow:600,fast:200,_default:400},task:{move:function(t,i,a,r,n,o,s){return s||(s=vec3.subtract(a,i,[0,0,0])),e.object.objects[t].translateVec3ObjectPos(vec3.scale(s,n,[0,0,0])),s},rotate:function(t,i,a,r,n,o){var s=n*a;return e.object.objects[t].mvMat4=mat4.rotate(e.object.objects[t].mvMat4,s*(Math.PI/180),o.axis),!0}},getFrom:{move:function(t){return e.object.objects[t].vObjectPos},rotate:function(t){return e.object.objects[t].mvMat4}},step:function(t,i,a,r,n,o,s,l,c,u){n+=1,u=e.fx.task[i](t,a,r,n,o,c,u),1>=n*o?window.setTimeout(s.step,13,t,i,a,r,n,o,s,l,c,u):l({action:i})}}}(glQuery),function(e,t,i){"use strict";var a=e.glQuery=function(e,t){return new a.fn.init(e,t)};a.prototype=a.fn={version:"",init:function(e,r){if(i.extend(this,a.fn),t.log(r),this.selector=e,e){if(this.type=e.match(a.fn.match.TYPE),this.type)switch(this.type=this.type[1],this.type){case"object":this.objects=a.object.objects;break;case"camera":break;case"light":break;default:this.objects=a.object.objects}return this.art=e.match(a.fn.match.ART),this.art&&(this.objects=a.object.getObjectByArt(this.art[1]),this.art=this.art[1]),this.id=e.match(a.fn.match.ID),this.id&&(this.objects=a.object.getObjectById(this.id[1]),this.id=this.id[1]),this}return this.selector="all",this},light:function(e,i,a,r,n){return this.options.debug&&(t.log(e),t.log(i),t.log(a),t.log(r),t.log(n)),this},camera:function(e,i,r){return a.camera.add(e,this.art,this.id,i,r),this.orthographic=function(e,i,a,r){t.log(e),t.log(i),t.log(a),t.log(r)},this.perspective=function(e){t.log(e)},this},bind:function(e,t){var r=this;return t?(a.event[e].i=a.event[e].i++,a.event[e][a.event[e].i]={obj:this.objects,callback:t},this):"object"!=typeof e?this:(i.each(e,function(e){return e.callback?(a.event[e.type].i=a.event[e.type].i++,a.event[e.type][a.event[e.type].i]={obj:r.id,callback:e.callback},r):a.event.trigger(e.type,r.objects,!1,{})}),this)},click:function(e){return this.bind("click",e)},near:function(e){return this.bind("near",e)},move:function(e,t,i,r){return t?(a.animation.createAnimationHandler(this.objects,{action:"move",end:e},t,i,r),this):this.bind("move",r)},collision:function(e){return this.bind("collision",e)},touch:function(e){return this.bind("touch",e)},copyTranslate:function(e,i){return this.options.debug&&(t.log(e),t.log(i)),this},lookAt:function(e,i){return this.options.debug&&(t.log(e),t.log(i)),this},rotate:function(e,t,i,r,n){return t?(a.animation.createAnimationHandler(this.objects,{action:"rotate",end:e,axis:t},i,r,n),this):this.bind("rotate",n)},translate:function(e){return e?(a.action.createActionHandler("translatePosition",e,this.objects),this):this},position:function(e){return e?(a.action.createActionHandler("setPosition",e,this.objects),this):a.objects.getPosition(this.selector)},animate:function(e,t,i,r){return t?(a.animation.createAnimationHandler(this.objects,e,t,i,r),this):this.bind("animation",e)},match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,ART:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,PART:/\[part=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,TYPE:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/}},i(document).ready(function(){var e=i("canvas[type='glQuery']").attr("debug"),t=i("canvas[type='glQuery']").attr("framerate"),r=i("canvas[type='glQuery']").attr("partTo"),n=i("canvas[type='glQuery']").attr("scene"),o=i("canvas[type='glQuery']").attr("id");a.create({debug:e,framerate:t,partTo:r,scene:n,id:o})}),a.create=function(e){if(t.time("glQuery.create() 1"),jQuery.extend(this.options,e),t.log(this.options),"undefined"==typeof Worker)return t.error("No Web Worker support"),!1;this.renderWorker=new Worker(this.options.partTo+"static/worker/glQuery.render.worker.js"),this.imageWorker=new Worker(this.options.partTo+"static/worker/glQuery.image.worker.js"),this.progressWorker=new Worker(this.options.partTo+"static/worker/glQuery.progress.worker.js"),this.imageWorker.onmessage=function(e){e.data&&a.event.trigger("ready","undefined",!0,a)},this.canvas="#"+this.options.id,jQuery("canvas").after("<div class='glQuery-winmode-layer hidden-fullscreen'></div>"),jQuery(".glQuery-gui .glQuery-winmode section").append("<div class='glQuery-fullscreen hidden-fullscreen'><a id='' href='#' class='btn btn-primary'>Fullscreen</a><p>glQuery.js only work in the fullscreen-modus!</p></div>"),this.progressBar(),this.fullscreenObject=document.getElementById(this.options.id),this.checkBrowser(),this.setHeight(screen.height),this.setWidth(screen.width),this.options.lockmouse&&(this.progressBarStep("lockmouse",0),this.lockMouse(),this.progressBarStep("lockmouse",2)),this.fullscreen();var i=a.webGL.createWebGL();if(i){a.camera.cameraMatrix(!0);var r=this.fileType(this.options.scene);switch(r){case"dae":a.collada.scene.parse(this.options.scene);break;case"xml":this.addFileMap(),a.camera.add("perspective","cam","test_cam",.1,100);break;default:t.error("File extension not supported!")}a.scene.createRender(!0)}else t.error("Failed to create Webgl")},a.pointerLock={Error:function(){t.log("Error while locking pointer.")},Change:function(){t.log("Change locking pointer.")}},a.lockMouse=function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.addEventListener("pointerlockchange",a.pointerLock.Change,!1),document.addEventListener("mozpointerlockchange",a.pointerLockChange,!1),document.addEventListener("webkitpointerlockchange",a.pointerLock.Change,!1),document.addEventListener("pointerlockerror",a.pointerLock.Error,!1),document.addEventListener("mozpointerlockerror",a.pointerLock.Error,!1),document.addEventListener("webkitpointerlockerror",a.pointerLock.Error,!1),document.addEventListener("mousemove",function(e){if(a.allowrender){var i=e.movementX||e.mozMovementX||e.webkitMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||0,n=Math.abs(i),o=Math.abs(r);400>n+o&&t.log("movementX="+i,"movementY="+r)}},!1)},a.fileType=function(e){var t=e.split(".");return t=t[t.length-1]},a.ready=function(e){a.event.add("ready","undefined",e)},a.progressBarStep=function(e,t,i){var r={};r=void 0===i?{step:{type:e,value:t}}:{step:{type:e,value:t,max:i}},a.progressWorker.postMessage(r)},a.progressBar=function(e,i){this.options.debug&&t.log(i),jQuery(".glQuery-gui .glQuery-winmode section").append('<div class="glQuery-intro-progressbar progress progress-striped active hidden-fullscreen"><div class="bar" style="width: '+e+'%;"></div></div><div class="glQuery-intro-tooltip tooltip bottom in fade"><div class="tooltip-arrow"></div><div class="tooltip-inner">'+a.options.progressBar.infoStep.init+"</div></div>");var r=jQuery(".glQuery-intro-progressbar .bar"),n=jQuery(".glQuery-intro-tooltip .tooltip-inner");this.progressWorker.postMessage({options:{lockMouse:a.options.lockMouse}}),this.progressWorker.onmessage=function(e){var t=e.data;r.width(t.value+"%"),a.options.progressBar.info!==t.info&&(a.options.progressBar.info=t.info,n.html(a.options.progressBar.infoStep[t.info]))},this.progressBarStep("init",0),this.options.progressBar.visible=!0},a.checkBrowser=function(){return this.progressBarStep("checkbrowser",0),this.options.lockMouse&&(a.fullscreenObject.requestPointerLock=a.fullscreenObject.requestPointerLock||a.fullscreenObject.mozRequestPointerLock||a.fullscreenObject.webkitRequestPointerLock,this.progressBarStep("checkbrowser",1),void 0!==a.fullscreenObject.requestPointerLock)?!1:document.mozCancelFullScreen||document.webkitCancelFullScreen||document.cancelFullScreen||document.mozFullScreen||document.webkitFullScreen||document.fullScreen?void 0:!1},a.fullscreen=function(){t.info("glQuery.fullscreen()");var e=this;document.addEventListener("fullscreenchange",this.toggleRenderer,!1),document.addEventListener("mozfullscreenchange",this.toggleRenderer,!1),document.addEventListener("webkitfullscreenchange",this.toggleRenderer,!1),i(document).keypress(function(t){13===t.keyCode&&e.toggleFullscreen()}),i(".glQuery-fullscreen a").on("click",function(t){e.toggleFullscreen(),t.preventDefault()}),this.progressBarStep("fullscreen",5)},a.toggleRenderer=function(){a.allowrender?(a.allowrender=!1,a.options.lockMouse&&document.exitPointerLock()):(a.options.lockMouse&&a.fullscreenObject.requestPointerLock(),a.allowrender=!0)},a.toggleFullscreen=function(){t.info("glQuery.toggleFullscreen()"),document.mozFullScreen||document.webkitFullScreen||document.fullScreen?document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen():this.fullscreenObject.mozRequestFullScreen?(this.fullscreenObject.mozRequestFullScreen(),a.renderWorker.postMessage("fullscreen")):(this.fullscreenObject.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),a.renderWorker.postMessage("fullscreen"))},a.getHeight=function(){return this.canvasHeight},a.setHeight=function(e){null===e?e=this.canvasHeight:this.canvasHeight=e,i(this.canvas).attr("height",e)},a.getWidth=function(){return this.canvasWidth},a.setWidth=function(e){null===e?e=this.canvasWidth:this.canvasWidth=e,i(this.canvas).attr("width",e)},a.allowrender=!1,a.canvasWidth=0,a.canvasHeight=0,a.distance=100,a.workerinit=!1,a.options={partTo:"glQuery.js/",debug:!1,lockMouse:!1,progressBar:{value:0,visible:!1,info:"init",infoStep:{init:"Initialize the 3D Engine!",checkbrowser:"Check the Browser Compatibility!",fullscreen:"Make possible to run the Fullscreen-Modus!",lockmouse:"Locking the mouse!",createwebgl:"Creating the 3D Plattform!",loadingmodels:"Loading the 3D Objects!",loadinglights:"Lights beginning to add!",connect:"Where is connection...?"}}}}(window,window.console,jQuery),function(e){e.event={click:[],move:[],near:[],touch:[],collision:[],keyboard:[],camera:[],light:[],addObject:[],animation:[],error:[],complete:[],ready:[],options:{},add:function(e,t,i){this[e][t]=i},trigger:function(e,t,i,a){var r={};if(r.auto=i,r.data=a,"string"==typeof t||"number"==typeof t)for(var n in this[e])n===t&&this[e][n](r);else for(var o=0;t.length>t;o++)for(var s in this[e])s===t[o]&&this[e][s](r);return!0}}}(glQuery),function(e){e.physics={collision:!0,gravity:10,particles:{water:{},fire:{},sand:{}},render:function(e){console.log(e)}}}(glQuery),function(e){e.input={mouse:{down:function(){},move:function(){},up:function(){},onDown:function(){},onMove:function(){},onUp:function(){}},keyboard:{up:function(){},down:function(){},onUp:function(){},onDown:function(){},keyCode:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18}}}}(glQuery),function(e){e.collada.animation={}}(glQuery),function(e){e.collada.camera={debug:!1,instanceCamera:function(e,t){this.debug&&(console.log(e),console.log(t))}}}(glQuery),function(e,t){e.collada={debug:!1,getCollada:function(e,i,a){var r=this;this.debug&&(console.log(e),console.log(i),console.log(a)),t.ajax({url:e,dataType:"xml",error:function(e){a(e)},success:function(e){var t=r.getColladaNode(e),a=r.parseMeta(t);i(t,a)}})},initParse:function(e){return this.debug&&console.log(e),t(e)},parseMeta:function(e){this.debug&&console.log(e);var t={};t.library=this.getLibraries(e),t.upAxis=0;for(var i=0;e.children.length>i;i++){var a=e.children.item(i);if(this.debug&&console.info(a.nodeName),"up_axis"===a.nodeName){switch(a.innerHTML){case"Y_UP":t.upAxis=0;break;case"Z_UP":t.upAxis=1;break;case"X-UP":case"X_UP":t.upAxis=2;break;default:t.upAxis=0}break}}return this.debug&&console.info(t),t},getColladaNode:function(e){return this.getChildNodeByName(e,"COLLADA")},getChildNodeByName:function(e,t){this.debug&&(console.log(e),console.log(t));for(var i=null,a=0;e.children.length>a;a++){var r=e.children.item(a);this.debug&&console.info(r.nodeName),t===r.nodeName&&(i=r)}return i},getLibraries:function(e){this.debug&&console.log(e);for(var t={},i=0;e.children.length>i;i++){var a=e.children.item(i);this.debug&&console.info(a.nodeName);var r=a.nodeName,n=r.split("_");n=n[0],"library"===n&&(t[r]=a)}return this.debug&&console.log(t),t},parseIntArray:function(e){if(e=(""+e).replace(/^\s+/,"").replace(/\s+$/,""),""===e)return[];for(var t=e.split(/\s+/),i=new Int32Array(t.length),a=0,r=0;t.length>a;a++)0!==t[a].length&&null!=t[a]&&(i[r++]=parseInt(t[a],10));return i},parseFloatArray:function(e){if(e=(""+e).replace(/^\s+/,"").replace(/\s+$/,""),""===e)return[];for(var t=e.split(/\s+/),i=new Float32Array(t.length),a=0,r=0;t.length>a;a++)0!==t[a].length&&(i[r++]=parseFloat(t[a]));return i},parseBoolArray:function(e){if(e=(""+e).replace(/^\s+/,"").replace(/\s+$/,""),""===e)return[];for(var t=e.split(/\s+/),i=Array(t.length),a=0,r=0;t.length>a;a++)0!==t[a].length&&(i[r++]=parseBool(t[a]));return i},sortCoord:function(e,t){switch(t){case 0:return e;case 1:return[e[0],e[2],-e[1]];case 2:return[-e[1],e[0],e[2]]}},parseURI:function(e,t){return-1===e.indexOf("/")?jQuery(t).find(e):undefined}}}(glQuery,jQuery),function(e){e.collada.light={debug:!1,instanceLight:function(t,i){this.debug&&(console.log(i),console.log(t));var a={},r=e.collada.parseURI(t,i.data).get(0);this.debug&&console.log(r);for(var n=0;r.children.length>n;n++){var o=r.children.item(n);switch(this.debug&&console.info(o),o.nodeName){case"technique_common":a=this.techniqueCommon(o,i);break;case"technique":break;case"asset":break;case"extra":}}return a},techniqueCommon:function(e,t){var i={};this.debug&&(console.log(t),console.log(e));for(var a=0;e.children.length>a;a++){var r=e.children.item(a);switch(this.debug&&console.info(r),r.nodeName){case"ambient":i.type="ambient",i.ambient=this.parseAmbient(r,t);break;case"point":i.type="point",i.point=this.parsePoint(r,t);break;case"spot":i.type="spot",i.spot=this.parseSpot(r,t);break;case"directional":i.type="directional",i.directional=this.parseDirectional(r,t)}}return i},parseSpot:function(t,i){var a={};this.debug&&(console.log(i),console.log(t));for(var r=0;t.children.length>r;r++){var n=t.children.item(r);switch(this.debug&&console.info(n),n.nodeName){case"color":a.color=e.collada.parseFloatArray(n.textContent);break;case"constant_attenuation":a.constantAttenuation=n.textContent?parseFloat(n.textContent):1;break;case"linear_attenuation":a.linearAttenuation=n.textContent?parseFloat(n.textContent):0;break;case"quadratic_attenuation":a.quadraticAttenuation=n.textContent?parseFloat(n.textContent):0;break;case"falloff_angle":a.falloffAngle=n.textContent?parseFloat(n.textContent):180;break;case"falloff_exponent":a.falloffExponent=n.textContent?parseFloat(n.textContent):0}}return a},parseAmbient:function(t,i){var a={};this.debug&&(console.log(i),console.log(t));for(var r=0;t.children.length>r;r++){var n=t.children.item(r);this.debug&&console.info(n),"color"===n.nodeName&&(a.color=e.collada.parseFloatArray(n.textContent))}return a},parsePoint:function(t,i){var a={};this.debug&&(console.log(i),console.log(t));for(var r=0;t.children.length>r;r++){var n=t.children.item(r);switch(this.debug&&console.info(n),n.nodeName){case"color":a.color=e.collada.parseFloatArray(n.textContent);break;case"constant_attenuation":a.constantAttenuation=n.textContent?parseFloat(n.textContent):1;break;case"linear_attenuation":a.linearAttenuation=n.textContent?parseFloat(n.textContent):0;break;case"quadratic_attenuation":a.quadraticAttenuation=n.textContent?parseFloat(n.textContent):!1}}return a},parseDirectional:function(t,i){var a={};this.debug&&(console.log(i),console.log(t));for(var r=0;t.children.length>r;r++){var n=t.children.item(r);this.debug&&console.info(n),"color"===n.nodeName&&(a.color=e.collada.parseFloatArray(n.textContent))}return a}}}(glQuery,jQuery),function(e,t){e.collada.material={bindMaterial:function(e,t){this.data=t.data,this.meta=t.meta;var i=this,a={};return e.find("> *").each(function(){switch(this.nodeName){case"param":break;case"technique_common":a=i.techniqueCommon(this);break;case"technique":break;case"extra":}}),a},techniqueCommon:function(e){var i=this,a={};return t(e).find("> *").each(function(){"instance_material"===this.nodeName&&(a[this.getAttribute("symbol")]={},a[this.getAttribute("symbol")].target=this.getAttribute("target"),a[this.getAttribute("symbol")].material=i.instanceMaterial(this))}),a},instanceMaterial:function(t){var i={};return i=this.getMaterial(e.collada.parseURI(t.getAttribute("target"),this.data))},getMaterial:function(e){var t=this,i={};return e.find("> *").each(function(){switch(this.nodeName){case"asset":break;case"instance_effect":i=t.instanceEffect(this);break;case"extra":}}),i},instanceEffect:function(t){var i={};return i=this.getEffect(e.collada.parseURI(t.getAttribute("url"),this.data))},getEffect:function(e){var t=this,i={};return e.find("> *").each(function(){switch(this.nodeName){case"asset":break;case"annotate":break;case"profile_BRIDGE":break;case"profile_CG":break;case"profile_GLES":break;case"profile_GLES2":break;case"profile_GLSL":break;case"profile_COMMON":i=t.getProfileCOMMON(this);break;case"newparam":break;case"extra":}}),i},getProfileCOMMON:function(e){var i=this,a={};return t(e).find("> *").each(function(){switch(this.nodeName){case"technique":a=i.getTechnique(this);break;case"asset":break;case"newparam":break;case"extra":}}),a},getTechnique:function(e){var i=this,a={};return t(e).find("> *").each(function(){switch(this.nodeName){case"asset":break;case"annotate":break;case"blinn":break;case"constant":break;case"lambert":break;case"phong":a.phong={},a.phong=i.getPhong(this);break;case"pass":break;case"extra":}}),a},getPhong:function(e){var i=this,a={},r=["emission","ambient","diffuse","specular","transparent","reflective"],n=["reflectivity","transparency","shininess","index_of_refraction"];t(e).find("> *").each(function(){switch(this.nodeName){case"emission":case"ambient":case"diffuse":case"specular":case"transparent":case"reflective":a[this.nodeName]=i.getCommonColorOrTexture(this);break;case"reflectivity":case"transparency":case"shininess":case"index_of_refraction":a[this.nodeName]=i.getCommonFloat(this)}});for(var o in r)a[r[o]]||(a[r[o]]=new Float32Array([0,0,0,1]));for(var s in n)a[n[s]]||(a[n[s]]=0);return a},getCommonFloat:function(e){var t=0,i=e.firstElementChild;return t="float"===i.nodeName?parseFloat(i.textContent):this.getCommonParam(i.getAttribute("ref"))},getCommonColorOrTexture:function(t){var i,a=this,r=t.firstElementChild;switch(r.nodeName){case"color":i=e.collada.parseFloatArray(r.textContent);break;case"texture":i=e.collada.instanceTexture(r,a);break;case"param":i=this.getCommonParam(r.getAttribute("ref"))}return i},getCommonParam:function(i){var a,r=t("[sid="+i+"]");return r.find("> *").each(function(){switch(this.nodeName){case"float":a=parseFloat(this.textContent);break;case"float2":case"float3":case"float4":a=e.collada.parseFloatArray(this.textContent);break;case"sampler2D":}}),a||(a=0),a},bindStandardMaterial:function(){var e={};return e.material={},e.material.material={},e.material.material.phong={ambient:[0,0,0,1],diffuse:[.4,.4,.4,1],emission:[0,0,0,1],index_of_refraction:1,reflective:[0,0,0,1],reflectivity:0,shininess:50,specular:[.8,.8,.8,1],transparency:0,transparent:[0,0,0,1]},e}}}(glQuery,jQuery),function(e,t,i){e.collada.mesh={debug:!1,debugLevel:0,instanceMesh:function(e,t){this.debug&&(console.info("glQuery.collada.mesh.instanceMesh"),console.log(t),console.log(e));var i=this,a={};this.data=t.data,this.meta=t.meta,a.source={},a.primitiveElements={};for(var r=0;e.children.length>r;r++){var n=e.children.item(r);switch(this.debug&&this.debugLevel>0&&console.info(n.nodeName),n.nodeName){case"source":a.source[n.getAttribute("id")]=i.getSource(n);break;case"vertices":a.vertices={};for(var o=0;n.children.length>o;o++){var s=n.children.item(o);this.debug&&this.debugLevel>0&&console.info(s.nodeName),"input"===s.nodeName&&(a.vertices[s.getAttribute("semantic")]=s.getAttribute("source"))}break;case"lines":case"linestrips":case"polylist":case"triangles":case"trifans":case"tristrips":var l=n.getAttribute("material");a.materialUrl=l?l:"material",a.primitiveElements=i.parsePrimitiveElements(n,n.nodeName);break;case"polygons":break;case"extra":}}return a=this.putSourceAndPrimitiveTogether(a)},putSourceAndPrimitiveTogether:function(e){var t={};t.materialUrl=e.materialUrl;var i;for(var a in e.primitiveElements)i=e.source[(""+e.primitiveElements[a].source).replace("#","")],"VERTEX"===a&&(i=e.source[(""+e.vertices.POSITION).replace("#","")]),t[a]={vertices:this.parseSource(i),indices:e.primitiveElements[a].p},this.debug&&(console.info("glQuery.collada.putSourceAndPrimitiveTogether"),console.log(a),console.log(i),console.log(t[a]));return t},parseSource:function(e){var t=[],i=parseInt(e.accessor.count,10),a=parseInt(e.accessor.stride,10),r=e.accessor.param;if(3===a&&"float"===r.X&&"float"===r.Y&&"float"===r.Z)for(var n=0;i>n;n++)switch(this.meta.upAxis){case 0:t[n*a+0]=e.array_element[n*a+0],t[n*a+1]=e.array_element[n*a+1],t[n*a+2]=e.array_element[n*a+2];break;case 1:t[n*a+0]=e.array_element[n*a+0],t[n*a+1]=e.array_element[n*a+2],t[n*a+2]=-1*e.array_element[n*a+1];break;case 2:t[n*a+0]=-1*e.array_element[n*a+1],t[n*a+1]=e.array_element[n*a+0],t[n*a+2]=e.array_element[n*a+2]}return t},parseInput:function(e){this.debug&&console.log("glQuery.collada.mesh.parseInput");for(var t={},i=0,a=0;e.children.length>a;a++){var r=e.children.item(a);this.debug&&this.debugLevel>0&&console.info(r.nodeName),"input"===r.nodeName&&(i=Math.max(i,parseInt(r.getAttribute("offset"),10)),t[r.getAttribute("semantic")]={source:r.getAttribute("source"),offset:parseInt(r.getAttribute("offset"),10)})}return t.offset=i,t},parsePrimitiveElements:function(i,a){var r=this.parseInput(i),n={},o=e.collada.parseIntArray(e.collada.getChildNodeByName(i,"p").textContent),s={},l=i.getAttribute("count");if(this.debug&&(console.log("glQuery.collada.mesh.parsePrimitiveElements"),console.log(a),console.log(o),console.log(r),console.log(i)),"polylist"===a){var c=e.collada.parseIntArray(t(i).find("vcount").text());n=this.parse[a](r,o,c,l)}else n=this.parse[a](r,o,l);for(var u in n)s[u]={source:r[u].source,p:n[u]};return this.debug&&console.log(n),s},parse:{triangles:function(e,t){for(var i=[],a=0;e.offset>=a;a=a){a+=1,i[a-1]=[];for(var r=0;t.length/(e.offset+1)>=r;r++)i[a-1][r]=t[r*(e.offset+1)+(a-1)]}var n=[];for(var o in e)"offset"!==o&&(n[o]=i[e[o].offset]);return n},lines:function(e,t){console.log(e),console.log(t)},polylist:function(t,a,r,n){this.debug&&console.log(n);for(var o=0,s=0;r.length>s;s++){if(3>r[s])return!1;o=o+3+3*(r[s]-3)}for(var l=[],c=0;t.offset>=c;c=c){c+=1,l[c-1]=new Int32Array(o);for(var u=0,h=0,f=0;r.length>f;f++){if(3>r[f])return!1;if(r[f]>3){for(var g=[],m=0;r[f]>m;m++)g[m]=a[m*(t.offset+1)+(c-1)+u];g=e.collada.mesh.createTriganlesByPolygons(g);for(var d=0;g.length>d&&g[d]!==i;d++)l[c-1][d+h]=g[d];h+=g.length}else{for(var v=0;3>v&&a[v+(t.offset+1)*u]!==i;v++)l[c-1][v+h]=a[v*(t.offset+1)+(c-1)+u];h+=3}u+=r[f]*(t.offset+1)}}var p=[];for(var b in t)"offset"!==b&&"VERTEX"!==b?p[b]=l[t[b].offset]:"VERTEX"===b&&(p[b]=l[t[b].offset]);return p}},checkPrimitiveElements:function(e){for(var t=0;e.length/3>t;t++)e[3*t]===e[3*t+1]&&console.error("Tri:"+t+" => "+e[3*t]),e[3*t+2]===e[3*t+1]&&console.error("Tri:"+t+" => "+e[3*t+1]),e[3*t]===e[3*t+2]&&console.error("Tri:"+t+" => "+e[3*t])},createTriganlesByPolygons:function(e){for(var t=[],i=0;e.length-2>i;i++)t[3*i]=e[0],t[3*i+1]=e[1+i],t[3*i+2]=e[2+i];return t},getSource:function(t){for(var i=this,a={},r=0;t.children.length>r;r++){var n=t.children.item(r);switch(this.debug&&this.debugLevel>0&&console.info(n.nodeName),n.nodeName){case"bool_array":a.array_element=e.collada.parseBoolArray(n.textContent);break;case"float_array":a.array_element=e.collada.parseFloatArray(n.textContent);break;case"int_array":a.array_element=e.collada.parseIntArray(n.textContent);break;case"Name_array":break;case"SIDREF_array":break;case"token_array":break;case"IDREF_array":break;case"technique_common":a.accessor=i.getTechniqueCommon(n);break;case"technique":}}return a},getTechniqueCommon:function(e){for(var t=this,i={},a=0;e.children.length>a;a++){var r=e.children.item(a);this.debug&&this.debugLevel>0&&console.info(r.nodeName),"accessor"===r.nodeName&&(i.param=t.getAccessor(r),i.count=r.getAttribute("count"),r.getAttribute("stride")&&(i.stride=r.getAttribute("stride")),r.getAttribute("offset")&&(i.offset=r.getAttribute("offset")))}return i},getAccessor:function(e){for(var t={},i=0;e.children.length>i;i++){var a=e.children.item(i);this.debug&&this.debugLevel>0&&console.info(a.nodeName),"param"===a.nodeName&&(t[a.getAttribute("name")]=a.getAttribute("type"))}return t}},e.collada.geometry={instanceGeometry:function(t,i){var a=this,r={};this.data=i.data,this.meta=i.meta,this.geometry=e.collada.parseURI(t,this.data).get(0);for(var n=0;this.geometry.children.length>n;n++){var o=this.geometry.children.item(n);switch(this.debug&&console.info(o.nodeName),o.nodeName){case"mesh":r.mesh=e.collada.mesh.instanceMesh(o,a);break;case"convex_mesh":break;case"extra":}}return r}}}(glQuery,jQuery),function(e){e.collada.object={}}(glQuery),function(e,t){e.collada.scene={data:{},meta:{},debug:!1,parse:function(t){this.debug&&console.log("glQuery.collada.scene -> parse(file: "+t+")");var i=this;e.collada.getCollada(t,function(e,t){i.instanceScene(e,t)},function(e){console.log("glQuery.collada.scene -> parse() => error "+e)})},instanceScene:function(t,i){this.debug&&console.log(t);var a="",r="";this.data=t,this.meta=i;for(var n=e.collada.getChildNodeByName(t,"scene"),o=0;n.children.length>o;o++){var s=n.children.item(o);this.debug&&console.info(s.nodeName);var l=s.nodeName,c=l.split("_");c=c[0],"instance"===c&&(a=l,r=s.getAttribute("url"))}switch(a){case"instance_physics_scene":this.physicsScene(r);break;case"instance_visual_scene":this.visualScene(r);break;default:console.log("no more types are defined")}e.renderWorker.postMessage("objects"),e.imageWorker.postMessage("imageLoaded")},visualScene:function(i){var a=t(this.data).find(i).get(0);this.debug&&(console.log(i),console.log(a));var r=this.getNodes(a);e.progressBarStep("loadingmodels",30);for(var n in r)this.createObjectByNode(r[n])},createObjectByNode:function(i){var a={};a.id=i.getAttribute("id"),a.modelViewMatrix=mat4.create(),a.modelViewMatrix=mat4.identity(),a.position=[0,0,0];for(var r=0;i.children.length>r;r++){var n=i.children.item(r);switch(this.debug&&console.info(n.nodeName),n.nodeName){case"lookat":break;case"matrix":break;case"rotate":var o=e.collada.parseFloatArray(n.textContent);0!==o[3]&&(a.modelViewMatrix=mat4.rotate(a.modelViewMatrix,o[3],e.collada.sortCoord([o[0],o[1],o[2]],this.meta.upAxis)));break;case"scale":var s=e.collada.parseFloatArray(n.textContent);(1!==s[0]&&1!==s[1]&&1!==s[2]||0!==s[0]&&0!==s[1]&&0!==s[2])&&(a.modelViewMatrix=mat4.scale(a.modelViewMatrix,e.collada.sortCoord(s,this.meta.upAxis)));break;case"skew":break;case"translate":var l=e.collada.parseFloatArray(n.textContent);a.position=l,a.modelViewMatrix=mat4.translate(a.modelViewMatrix,e.collada.sortCoord(l,this.meta.upAxis));break;case"instance_camera":a.type="camera",a.camera=e.collada.camera.instanceCamera(n.getAttribute("url"),this),a.lookAt=e.camera.createLookAtByMvMatrix(a.modelViewMatrix);break;case"instance_controller":break;case"instance_geometry":a.type="object",a.geometry=e.collada.geometry.instanceGeometry(n.getAttribute("url"),this),a.material=t(n).find("bind_material").is("bind_material")?e.collada.material.bindMaterial(t(n).find("bind_material"),this):e.collada.material.bindStandardMaterial(),e.object.add(a.id,a.type,"test",a.geometry.mesh,a.material[a.geometry.mesh.materialUrl].material,{mvMat4:a.modelViewMatrix,position:a.position});break;case"instance_light":a.type="light",a.light=e.collada.light.instanceLight(n.getAttribute("url"),this),e.light.add(a.id,"test",a.light,{mvMat4:a.modelViewMatrix,position:a.position});break;case"instance_node":break;case"asset":}}},getNodes:function(e){for(var t=[],i=0;e.children.length>i;i++){var a=e.children.item(i);this.debug&&console.info(a.nodeName);var r=a.nodeName,n=r.split("_");n=n[0],"node"===n&&(t[t.length]=a)}return t}}}(glQuery,jQuery),function(e){e.collada.textures={}}(glQuery),function(e){e.blender={}}(glQuery),function(e){e.light.ambient={}}(glQuery),function(e){e.light.directional={}}(glQuery),function(e,t){e.light={shaderLight:{MAX_SPOT_LIGHTS:0,MAX_POINT_LIGHTS:0,MAX_DIR_LIGHTS:0,MAX_AMBIENT_LIGHTS:0},lights:[],art:[],id:[],i:0,add:function(e,t,a,r){var n=new i(e);n.setArt(t),n.setArt(a.type),n.setLightType(a.type),n.color=a[a.type].color;var o;switch(a.type){case"point":a.point.position=r.position,delete a.point.color,n.setLightData(a.point),this.shaderLight.MAX_POINT_LIGHTS=this.shaderLight.MAX_POINT_LIGHTS+1;break;case"ambient":delete a.ambient.color,n.setLightData(a.ambient),this.shaderLight.MAX_AMBIENT_LIGHTS=this.shaderLight.MAX_AMBIENT_LIGHTS+1;break;case"spot":a.spot.position=r.position,o=vec3.create([0,-1,0]),o=mat4.multiplyVec3(r.mvMat4,o),a.spot.direction=o,delete a.spot.color,n.setLightData(a.spot),this.shaderLight.MAX_SPOT_LIGHTS=this.shaderLight.MAX_SPOT_LIGHTS+1;break;case"directional":o=vec3.create([0,-1,0]),o=mat4.multiplyVec3(r.mvMat4,o),a.directional.direction=o,delete a.directional.color,n.setLightData(a.directional),this.shaderLight.MAX_DIR_LIGHTS=this.shaderLight.MAX_DIR_LIGHTS+1}this.lights[n.i]=n},getLightById:function(e,t){return console.log(t),[this.id[e]]},getLightByArt:function(e,t){return console.log(t),this.art[e]},uniformLighting:function(i){var a=[],r=[],n=[],o=[];for(var s in this.lights)switch(this.lights[s].lightType){case"point":r[r.length]={color:this.lights[s].color,position:this.lights[s].lightData.position,constantAttenuation:this.lights[s].lightData.constantAttenuation,linearAttenuation:this.lights[s].lightData.linearAttenuation,distance:this.lights[s].lightData.distance===t?0:this.lights[s].lightData.distance,quadraticAttenuation:this.lights[s].lightData.quadraticAttenuation};break;case"spot":r[r.length]={color:this.lights[s].color,position:this.lights[s].lightData.position,distance:this.lights[s].lightData.distance===t?0:this.lights[s].lightData.distance};
break;case"directional":o[o.length]={color:this.lights[s].color,direction:this.lights[s].lightData.direction};break;default:a[a.length]={color:this.lights[s].color}}if(0!==n.length,0!==r.length){for(var l=new Float32Array(3*r.length),c=new Float32Array(3*r.length),u=new Float32Array(r.length),h=new Float32Array(r.length),f=new Float32Array(r.length),g=new Float32Array(r.length),m=0;o.length>m;m++)l[3*m+0]=r[m].color[0],l[3*m+1]=r[m].color[1],l[3*m+2]=r[m].color[2],c[3*m+0]=r[m].position[0],c[3*m+1]=r[m].position[1],c[3*m+2]=r[m].position[2],g[m]=r[m].constantAttenuation,u[m]=r[m].distance,h[m]=r[m].linearAttenuation,f[m]=r[m].quadraticAttenuation;e.gl.uniform3fv(i.uniforms.light.uPointLightPosition.location,c),e.gl.uniform3fv(i.uniforms.light.uPointLightColor.location,l),e.gl.uniform1fv(i.uniforms.light.uPointLightDistance.location,u)}if(0!==o.length){for(var d=new Float32Array(3*o.length),v=new Float32Array(3*o.length),p=0;o.length>p;p++)d[3*p+0]=o[p].color[0],d[3*p+1]=o[p].color[1],d[3*p+2]=o[p].color[2],v[3*p+0]=o[p].direction[0],v[3*p+1]=o[p].direction[1],v[3*p+2]=o[p].direction[2];e.gl.uniform3fv(i.uniforms.light.uDirectionalLightDirection.location,v),e.gl.uniform3fv(i.uniforms.light.uDirectionalLightColor.location,d)}if(0!==a.length){for(var b=new Float32Array(3*a.length),y=0;o.length>y;y++)b[3*y+0]=a[y].color[0],b[3*y+1]=a[y].color[1],b[3*y+2]=a[y].color[2];e.gl.uniform3fv(i.uniforms.light.uAmbientLightColor.location,b)}}};var i=function(t){return this.id=0,this.i=0,this.type="light",this.art=[],this.light={},this.viewAble=!0,this.color=vec3.create(),this.lightData={},this.lightType=0,this.id=t,this.i=e.light.i,e.light.i=e.light.i+1,e.light.id[t]=this.i,this.getType=function(){return this.type},this.setArt=function(t){this.art[this.art.length]=t,e.light.art[this.art]||(e.light.art[this.art]=[]),e.light.art[this.art][e.light.art[this.art].length]=this.i},this.getArt=function(){return this.art},this.setLightType=function(e){this.lightType=e},this.getLightType=function(){return this.lightType},this.setViewAble=function(e){this.viewAble=e},this.getViewAble=function(){return this.viewAble},this.setLightData=function(e){this.lightData=e},this.getLightData=function(){return this.lightData},this}}(glQuery),function(e){e.light.point={}}(glQuery),function(e){e.light.spot={}}(glQuery),function(e){e.color={}}(glQuery),function(e){e.material={createShaderOptions:function(e){var t={fragmentType:"test",USE_TEXTURE:0,USE_TEXTURES:{}};for(var i in e)t.fragmentType=i;for(var a in e[t.fragmentType])switch(a){case"emission":case"ambient":case"diffuse":case"specular":e[t.fragmentType][a].type&&(t.USE_TEXTURE=t.USE_TEXTURE+1,t.USE_TEXTURES["USE_"+a.toUpperCase()+"_TEXTURE"]=!0)}return t},uniformMaterial:function(t,i){var a=!1;for(var r in t.uniforms[t.type]){switch(a=!1,r){case"fvSpecular":t.options.USE_TEXTURES.USE_SPECULAR_TEXTURE&&"fvSpecular"===r&&(a=!0);break;case"fvEmission":t.options.USE_TEXTURES.USE_SPECULAR_TEXTURE&&"fvEmission"===r&&(a=!0);break;case"fvAmbient":t.options.USE_TEXTURES.USE_SPECULAR_TEXTURE&&"fvAmbient"===r&&(a=!0);break;case"fvDiffuse":t.options.USE_TEXTURES.USE_SPECULAR_TEXTURE&&"fvDiffuse"===r&&(a=!0);break;case"fShininess":}if(a);else{var n=i[t.type][r.replace("fv","").toLowerCase()],o=t.uniforms[t.type][r],s=o.location;null!=s&&e.gl.uniform4f(s,n[0],n[1],n[2],n[3])}}}}}(glQuery),function(e){e.textures={}}(glQuery),function(e){e.mesh={Vertex:{Positions:{},Normals:{},Indices:{},BBox:{min:[0,0,0],max:[0,0,0]}},createNormalsArray:function(e,t,i,a){for(var r=0,n=0,o=new Float32Array(a),s=0;t.length>s;s++)r=t[s],n=e[s],o[3*r]=i[3*n],o[3*r+1]=i[3*n+1],o[3*r+2]=i[3*n+2];return o}}}(glQuery),function(e,t,i){e.object={init:function(){},add:function(t,i,r,n,o,s){console.time("glQuery.object.add()");var l=new a(t);return l.setType(i),l.setArt(r),l.setViewAble(!0),l.setMvMat4(s.mvMat4,s.position),l.setMaterial(o),l.setShaderProgram(e.shader.getShaderProgramKey(e.material.createShaderOptions(o))),l.setBuffers(this.createObjectBuffers(n,e.shader.shaders[l.shaderProgramKey]),e.shader.shaders[l.shaderProgramKey]),this.objects[l.i]=l,console.timeEnd("glQuery.object.add()"),!0},existId:function(t){return e.object.id[t]!==i?!0:e.light.id[t]!==i?!0:e.gui.id[t]!==i?!0:!1},createObjectBuffers:function(t,i){var a={};return a.VerticesBuffer=e.gl.createBuffer(),e.gl.bindBuffer(e.gl.ARRAY_BUFFER,a.VerticesBuffer),e.gl.bufferData(e.gl.ARRAY_BUFFER,new Float32Array(t.VERTEX.vertices),e.gl.STATIC_DRAW),-1!==i.attribute.aNormal.location&&(a.normal=e.gl.createBuffer(),e.gl.bindBuffer(e.gl.ARRAY_BUFFER,a.normal),e.gl.bufferData(e.gl.ARRAY_BUFFER,e.mesh.createNormalsArray(t.NORMAL.indices,t.VERTEX.indices,t.NORMAL.vertices,t.VERTEX.vertices.length),e.gl.STATIC_DRAW)),-1!==i.attribute.aTextureCoord.location&&(a.texcoord=e.gl.createBuffer(),e.gl.bindBuffer(e.gl.ARRAY_BUFFER,a.texcoord),e.gl.bufferData(e.gl.ARRAY_BUFFER,new Float32Array(t.TEXVOORD.vertices),e.gl.STATIC_DRAW)),a.VertexNum=t.VERTEX.vertices.length/3,a.itemSize=3,a.numItems=t.VERTEX.vertices.length/3,a.numIndices=t.VERTEX.indices.length,a.IndexBuffer=e.gl.createBuffer(),e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,a.IndexBuffer),e.gl.bufferData(e.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.VERTEX.indices),e.gl.STATIC_DRAW),a},getObjectById:function(e,t){return console.log(t),[this.id[e]]},getObjectByArt:function(e,t){return console.log(t),this.art[e]},getObjectByType:function(e,t){return console.log(t),this.type[e]},duplicate:function(){},objectWorker:null,objects:[],type:[],art:[],id:[],i:0,camera:{}};var a=function(i){return this.id=0,this.i=0,this.type="",this.art="",this.buffers={},this.mesh={},this.material={},this.textures={},this.viewAble=!0,this.mvMat4=mat4.create(),this.noMat3=mat4.create(),this.vObjectPos=vec3.create(),this.scaleVec3=vec3.create(),this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.shaderProgramKey=-1,this.id=i,this.i=e.object.i,e.object.i=e.object.i+1,e.object.id[i]=this.i,this.mvMat4=mat4.identity(this.mvMat4),this.setBuffers=function(e){this.buffers=e},this.getBuffers=function(){return this.buffers},this.setMesh=function(e){this.mesh=e},this.getMesh=function(){return this.mes},this.setTextures=function(e){this.textures=e},this.getTextures=function(){return this.textures},this.setMaterial=function(e){this.material=e},this.getMaterial=function(){return this.material},this.setType=function(t){this.type=t,e.object.type[this.type]||(e.object.type[this.type]=[]),e.object.type[this.type][e.object.type[this.type].length]=this.i},this.getType=function(){return this.type},this.setArt=function(t){this.art=t,e.object.art[this.art]||(e.object.art[this.art]=[]),e.object.art[this.art][e.object.art[this.art].length]=this.i},this.getArt=function(){return this.art},this.setViewAble=function(e){this.viewAble=e},this.getViewAble=function(){return this.viewAble},this.setMvMat4=function(e,t){this.vObjectPos=vec3.create(t),this.mvMat4=mat4.create(e),this.setNoMat3()},this.getMvMat4=function(){return this.mvMat4},this.scaleMvMat4=function(e){this.scaleVec3=vec3.create(e),this.mvMat4=mat4.scale(this.mvMat4,e),this.setNoMat3()},this.setNoMat3=function(){this.noMat3=mat4.toInverseMat3(this.mvMat4,this.noMat3),this.noMat3=t.transpose(this.noMat3)},this.setVec3ObjectPos=function(e){e||(e=[0,0,0]),this.mvMat4=mat4.translate(this.mvMat4,vec3.subtract(e,this.vObjectPos)),this.vObjectPos=vec3.create(e),this.setNoMat3()},this.translateVec3ObjectPos=function(e){e||(e=[0,0,0]),this.mvMat4=mat4.translate(this.mvMat4,e),this.vObjectPos=vec3.add(this.vObjectPos,e),this.setNoMat3()},this.getVec3ObjectPos=function(){return this.vObjectPos},this.rotateMvMat4=function(e,t,i){this.rotateX=e,this.rotateY=t,this.rotateZ=i,this.mvMat4=mat4.rotateX(this.mvMat4,e*(Math.PI/180)),this.mvMat4=mat4.rotateY(this.mvMat4,t*(Math.PI/180)),this.mvMat4=mat4.rotateZ(this.mvMat4,i*(Math.PI/180)),this.setNoMat3()},this.setShaderProgram=function(e){this.shaderProgramKey=e},this}}(glQuery,mat3),function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;t.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){console.log(i);var a=Date.now(),r=Math.max(0,16-(a-e)),n=window.setTimeout(function(){t(a+r)},r);return e=a+r,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(e,t){e.scene={createRender:function(i){var a=this;i&&this.showFramerate(),this.enableRender=!1,e.renderWorker.onmessage=function(i){i.data&&(e.camera.cameraMatrix(!0),this.tenthRendering=0,t.log("glQuery.scene.createRender() => init the render loop"),a.renderLoop())}},renderLoop:function(i){this.debug&&t.log(i),window.requestAnimationFrame(e.scene.renderLoop),e.allowrender&&e.scene.renderer()},renderer:function(){this.tenthRendering=this.tenthRendering+1,10===this.tenthRendering&&t.time("glQuery.scene.render()"),e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.gl.clearColor(1,1,1,1);for(var i in e.object.objects)this.drawObject(e.object.objects[i]);10===this.tenthRendering&&t.time("glQuery.scene.render()"),this.endFrameTime=(new Date).getTime(),this.createFramerate(),this.startFrameTime=(new Date).getTime(),this.setFramerate(this.framerate)},drawObject:function(i){10===this.tenthRendering&&t.time("glQuery.scene.drawObject()");var a=e.shader.shaders[i.shaderProgramKey];this.useProgram!==i.shaderProgramKey&&(e.gl.useProgram(a.shaderProgram),this.useProgram=i.shaderProgramKey,e.camera.uniformCamera(a),e.light.uniformLighting(a));var r=i.buffers;-1!==a.attribute.aNormal.location&&(e.gl.disableVertexAttribArray(a.attribute.aNormal.location),e.gl.bindBuffer(e.gl.ARRAY_BUFFER,r.normal),e.gl.vertexAttribPointer(a.attribute.aNormal.location,r.itemSize,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(a.attribute.aNormal.location)),-1!==a.attribute.aTextureCoord.location&&(e.gl.disableVertexAttribArray(a.attribute.aTextureCoord.location),e.gl.bindBuffer(e.gl.ARRAY_BUFFER,r.texcoord),e.gl.vertexAttribPointer(a.attribute.aTextureCoord.location,2,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(a.attribute.aTextureCoord.location)),-1!==a.attribute.aVertex.location&&(e.gl.disableVertexAttribArray(a.attribute.aVertex.location),e.gl.bindBuffer(e.gl.ARRAY_BUFFER,r.VerticesBuffer),e.gl.vertexAttribPointer(a.attribute.aVertex.location,r.itemSize,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(a.attribute.aVertex.location)),e.gl.uniformMatrix4fv(a.uniforms.common_vertex.uModelViewMatrix.location,!1,i.mvMat4),e.gl.uniformMatrix4fv(a.uniforms.common_vertex.uModelWorldMatrix.location,!1,mat4.identity()),e.material.uniformMaterial(a,i.material),e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,r.IndexBuffer),e.gl.drawElements(e.gl.TRIANGLES,r.numIndices,e.gl.UNSIGNED_SHORT,0),10===this.tenthRendering&&t.time("glQuery.scene.drawObject()")},setLighting:function(){e.gl.uniform3fv(e.webGL.uAmbientLight,new Float32Array([.3,.3,.3]))},moveCamera:function(){this.mLookAt=e.camera.lookAt},makePerspective:function(){this.pmMatrix=mat4.create(),this.pmMatrix=mat4.perspective(60,e.canvasWidth/e.canvasHeight,.1,100,this.pmMatrix)},renderAnimation:function(e){return e},renderPhysics:function(e){return e},getFramerate:function(){return this.framerate},setFramerate:function(e){29!==this.lastFramerates.length&&(this.lastFramerates[this.lastFramerates.length]=e);for(var t=0;29>t;t++)e+=this.lastFramerates[t];return e/=30,e=Math.round(e),e>=200?!0:20>=e?!0:!0},showFramerate:function(){return!0},createFramerate:function(){var e=this.endFrameTime-this.startFrameTime;return this.framerate=Math.round(1e3/e),this.framerate},debug:!1,useProgram:-1,tenthRendering:0,mvUniform:null,pmMatrix:null,vCamPos:[0,7,1],vLookAt:[0,0,-1],mLookAt:null,lastFramerates:[],renderObjects:[],renderObjectslength:0,createNewRenderObjects:!0,enableRender:!0,startFrameTime:0,endFrameTime:0,framerate:0,lastShowTimeFramerate:0}}(glQuery,window.console),function(e,t,i){e.shader={shaderSnippets:{transpose_function:["mat4 transpose (mat4 mat);","mat4 transpose (mat4 mat){","   float a01 = mat[0][1],a02 = mat[0][2],a03 = mat[0][3],a12 = mat[1][2],a13 = mat[1][3],a23 = mat[2][3];","   mat[0][1] = mat[1][0];","   mat[0][2] = mat[2][0];","   mat[0][3] = mat[3][0];","   mat[1][0] = a01;","   mat[1][2] = mat[2][1];","   mat[1][3] = mat[3][1];","   mat[2][0] = a02;","   mat[2][1] = a12;","   mat[2][3] = mat[3][2];","   mat[3][0] = a03;","   mat[3][1] = a13;","   mat[3][2] = a23;","   return mat;","}","mat3 transpose (mat3 mat);","mat3 transpose (mat3 mat){","   float a01 = mat[0][1],a02 = mat[0][2],a12 = mat[1][2];","   mat[0][1] = mat[1][0];","   mat[0][2] = mat[2][0];","   mat[2][0] = a01;","   mat[1][2] = mat[2][1];","   mat[2][0] = a02;","   mat[2][1] = a12;","   return mat;","}"].join("\n"),inverse_function:["mat4 inverse (mat4 mat);","mat4 inverse (mat4 mat){","   float a00 = mat[0][0], a01 = mat[0][1],a02 = mat[0][2], a03 = mat[0][3],","   a10 = mat[1][0], a11 = mat[1][1],a12 = mat[1][2], a13 = mat[1][3],","   a20 = mat[2][0], a21 = mat[2][1],a22 = mat[2][2], a23 = mat[2][3],","   a30 = mat[3][0], a31 = mat[3][1],a32 = mat[3][2], a33 = mat[3][3],","   b00 = a00 * a11 - a01 * a10,","   b01 = a00 * a12 - a02 * a10,","   b02 = a00 * a13 - a03 * a10,","   b03 = a01 * a12 - a02 * a11,","   b04 = a01 * a13 - a03 * a11,","   b05 = a02 * a13 - a03 * a12,","   b06 = a20 * a31 - a21 * a30,","   b07 = a20 * a32 - a22 * a30,","   b08 = a20 * a33 - a23 * a30,","   b09 = a21 * a32 - a22 * a31,","   b10 = a21 * a33 - a23 * a31,","   b11 = a22 * a33 - a23 * a32,","   d = (b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06),","   invDet;","   // Calculate the determinant","   if (d == 0.0) { return mat; }","   invDet = 1.0 / d;","   mat[0][0] = (a11 * b11 - a12 * b10 + a13 * b09) * invDet;","   mat[0][0] = (-a01 * b11 + a02 * b10 - a03 * b09) * invDet;","   mat[0][0] = (a31 * b05 - a32 * b04 + a33 * b03) * invDet;","   mat[0][0] = (-a21 * b05 + a22 * b04 - a23 * b03) * invDet;","   mat[1][0] = (-a10 * b11 + a12 * b08 - a13 * b07) * invDet;","   mat[1][0] = (a00 * b11 - a02 * b08 + a03 * b07) * invDet;","   mat[1][0] = (-a30 * b05 + a32 * b02 - a33 * b01) * invDet;","   mat[1][0] = (a20 * b05 - a22 * b02 + a23 * b01) * invDet;","   mat[2][0] = (a10 * b10 - a11 * b08 + a13 * b06) * invDet;","   mat[2][0] = (-a00 * b10 + a01 * b08 - a03 * b06) * invDet;","   mat[2][0] = (a30 * b04 - a31 * b02 + a33 * b00) * invDet;","   mat[2][0] = (-a20 * b04 + a21 * b02 - a23 * b00) * invDet;","   mat[3][0] = (-a10 * b09 + a11 * b07 - a12 * b06) * invDet;","   mat[3][0] = (a00 * b09 - a01 * b07 + a02 * b06) * invDet;","   mat[3][0] = (-a30 * b03 + a31 * b01 - a32 * b00) * invDet;","   mat[3][0] = (a20 * b03 - a21 * b01 + a22 * b00) * invDet;","   return mat;","}","mat3 inverseToMat3 (mat4 mat);","mat3 inverseToMat3 (mat4 mat){","   mat3 dest;","   // Cache the matrix values (makes for huge speed increases!)","   float a00 = mat[0][0], a01 = mat[0][1], a02 = mat[0][2],","   a10 = mat[1][0], a11 = mat[1][1], a12 = mat[1][2],","   a20 = mat[2][0], a21 = mat[2][1], a22 = mat[2][2],","   b01 = a22 * a11 - a12 * a21,","   b11 = -a22 * a10 + a12 * a20,","   b21 = a21 * a10 - a11 * a20,","   d = a00 * b01 + a01 * b11 + a02 * b21,","   id;","   if (d == 0.0) { return dest; }","   id = 1.0 / d;","   dest[0][0] = b01 * id;","   dest[0][1] = (-a22 * a01 + a02 * a21) * id;","   dest[0][2] = (a12 * a01 - a02 * a11) * id;","   dest[1][0] = b11 * id;","   dest[1][1] = (a22 * a00 - a02 * a20) * id;","   dest[1][2] = (-a12 * a00 + a02 * a10) * id;","   dest[2][0] = b21 * id;","   dest[2][1] = (-a21 * a00 + a01 * a20) * id;","   dest[2][2] = (a11 * a00 - a01 * a10) * id;","   return dest;","}"].join("\n"),pars_vertex:["#ifdef GL_ES","   precision highp float;","#endif","attribute    highp       vec3 aNormal;","attribute    highp       vec3 aVertex;","#ifdef USE_TEXTURE","   attribute    highp       vec2 aTextureCoord;","#endif","uniform      highp       mat4 uLookAt;","uniform      highp       mat4 uPerspectiveMatrix;","uniform      highp       mat4 uModelWorldMatrix;","uniform      highp       mat4 uModelViewMatrix;","#ifdef USE_TEXTURE","   varying      highp       vec2 vTextureCoord;","#endif","varying      highp       vec3 vNormal;","varying      highp       vec4 vViewPos;","varying                  mat4 vViewMatrix;"].join("\n"),vertex:["   mat4 objectModel   = uModelWorldMatrix * uModelViewMatrix;","   mat4 cameraModel   = uPerspectiveMatrix * uLookAt;","   gl_Position        = cameraModel * objectModel  * vec4(aVertex, 1.0);","   mat3 normalMatrix  = transpose(inverseToMat3(objectModel * uLookAt));","   vNormal            = normalMatrix * aNormal;","   #ifdef USE_TEXTURE","       vTextureCoord      = aTextureCoord;","   #endif","   vViewPos            = vec4(aVertex, 1.0);","   vViewMatrix         = objectModel * uLookAt;"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","#endif"].join("\n"),fog_fragement:["#ifdef USE_FOG","#endif"].join("\n"),phong_pars_fragment:["#ifdef GL_ES","   precision highp float;","#endif","#if MAX_POINT_LIGHTS > 0","   uniform        vec3    uPointLightColor[ MAX_POINT_LIGHTS ];","   uniform        vec3    uPointLightPosition[ MAX_POINT_LIGHTS ];","   uniform        float   uPointLightDistance[ MAX_POINT_LIGHTS ];","   uniform        float   uPointLightQuadraticAttenuation[ MAX_POINT_LIGHTS ];","   uniform        float   uPointLightLinearAttenuation[ MAX_POINT_LIGHTS ];","   uniform        float   uPointLightConstantAttenuation[ MAX_POINT_LIGHTS ];","#endif","#if MAX_DIR_LIGHTS > 0","   uniform        vec3    uDirectionalLightColor[ MAX_DIR_LIGHTS ];","   uniform        vec3    uDirectionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","   uniform        vec3    uSpotLightColor[ MAX_SPOT_LIGHTS ];","   uniform        vec3    uSpotLightPosition[ MAX_SPOT_LIGHTS ];","   uniform        float   uSpotLightDistance[ MAX_SPOT_LIGHTS ];","   uniform        float   uSpotLightConstantAttenuation[ MAX_SPOT_LIGHTS ];","   uniform        float   uSpotLightLinearAttenuation[ MAX_SPOT_LIGHTS ];","   uniform        float   uSpotLightQuadraticAttenuation[ MAX_SPOT_LIGHTS ];","   uniform        float   uSpotLightFalloffAngle[ MAX_SPOT_LIGHTS ];","   uniform        float   uSpotLightFalloffExponent[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_AMBIENT_LIGHTS > 0","   uniform        vec3 uAmbientLightColor[ MAX_AMBIENT_LIGHTS ];","#endif","#ifdef USE_DIFFUSE_TEXTURE","   uniform sampler2D fvDiffuse;","#else","   uniform vec4 fvDiffuse;","#endif","#ifdef USE_AMBIENT_TEXTURE","   uniform sampler2D fvAmbient;","#else","   uniform vec4 fvAmbient;","#endif","#ifdef USE_EMISSION_TEXTURE","   uniform sampler2D fvEmission;","#else","   uniform vec4 fvEmission;","#endif","#ifdef USE_SPECULAR_TEXTURE","   uniform sampler2D fvSpecular;","#else","   uniform vec4 fvSpecular;","#endif","uniform float fShininess;","uniform float fTransparency;","varying highp vec4 vViewPos;","varying vec3 vNormal;","varying mat4 vViewMatrix;","#ifdef USE_TEXTURE","   varying vec2 vTextureCoord;","#endif"].join("\n"),gui_pars_vertex:["#ifdef GL_ES","   precision highp float;","#endif","attribute    highp       vec3 aVertex;","#ifdef USE_TEXTURE","   attribute    highp       vec2 aTextureCoord;","#endif","uniform highp mat4 uOrthographicMatrix;","uniform highp mat4 uGuiMatrix;","#ifdef USE_TEXTURE","   varying      highp       vec2 vTextureCoord;","#endif"].join("\n"),gui_vertex:["   gl_Position        = uOrthographicMatrix * uGuiMatrix  * vec4(aVertex, 1.0);","   #ifdef USE_TEXTURE","       vTextureCoord      = aTextureCoord;","   #endif"].join("\n"),gui_pars_fragment:["#ifdef GL_ES","   precision highp float;","#endif","#ifdef USE_TEXTURE","   varying vec2 vTextureCoord;","   uniform sampler2D fvColor;","#else","   uniform vec4 fvColor;","#endif"].join("\n"),gui_fragment:["#ifdef USE_TEXTURE","    gl_FragColor = texture2D(fvColor,vTextureCoord);","#else","    gl_FragColor = fvColor;","#endif"].join("\n"),phong_fragment:["vec4 fvTotalDiffuse = vec4(0.0,0.0,0.0,fTransparency);","vec4 fvTotalSpecular = vec4(0.0,0.0,0.0,fTransparency);","vec4 vViewPosition = vViewMatrix * vViewPos;","vec4 viewPosition = normalize( vViewPosition );","vec3 normal = normalize(vNormal);","#if MAX_POINT_LIGHTS > 0","    vec3 fvPointDiffuse  = vec3( 0.0 );","    vec3 fvPointSpecular  = vec3( 0.0 );","    for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","        vec4 lPosition = vViewMatrix * vec4( uPointLightPosition[ i ], 1.0 );","        vec3 lVector = lPosition.xyz + vViewPosition.xyz;","        float lDistance = 1.0;","        if ( uPointLightDistance[ i ] > 0.0 )","            lDistance = 1.0 - min( ( length( lVector ) / uPointLightDistance[ i ] ), 1.0 );","        lVector = normalize( lVector );","        float fvPointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","        #ifdef USE_DIFFUSE_TEXTURE","            fvPointDiffuse += texture2D(fvDiffuse,vTexcoord).xyz * uPointLightColor[ i ] * fvPointDiffuseWeight * lDistance;","        #else","            fvPointDiffuse += fvDiffuse.xyz * uPointLightColor[ i ] * fvPointDiffuseWeight * lDistance;","        #endif","        vec3 fvPointHalfVector = normalize( lVector + viewPosition.xyz );","        float fvPointDotNormalHalf = max( dot( normal, fvPointHalfVector ), 0.0 );","        float fvPointSpecularWeight = max( pow( fvPointDotNormalHalf, fShininess ), 0.0 );","        #ifdef USE_SPECULAR_TEXTURE","            fvPointSpecular += texture2D(fvSpecular,vTexcoord).xyz * uPointLightColor[ i ] * fvPointSpecularWeight * fvPointDiffuseWeight * lDistance;","        #else","            fvPointSpecular += fvSpecular.xyz * uPointLightColor[ i ] * fvPointSpecularWeight * fvPointDiffuseWeight * lDistance;","        #endif","    }","    fvTotalDiffuse.xyz += fvPointDiffuse.xyz;","    fvTotalSpecular.xyz += fvPointSpecular.xyz;","#endif","#if MAX_DIR_LIGHTS > 0","    vec3 fvDirDiffuse  = vec3( 0.0 );","    vec3 fvDirSpecular  = vec3( 0.0 );","    for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","        vec4 vDirection = vViewMatrix * vec4( uDirectionalLightDirection[ i ], 0.0 );","        vec3 fvDirVector = normalize( vDirection.xyz );","        float fvDirDiffuseWeight = max( dot( vNormal, dirVector ), 0.0 );","        #ifdef USE_DIFFUSE_TEXTURE","        fvDirDiffuse += fvDirDiffuseWeight * texture2D(fvDiffuse,vTexcoord) * uDirectionalLightColor[i];","        #else","        fvDirDiffuse += fvDirDiffuseWeight * fvDiffuse * uDirectionalLightColor[i];","        #endif","        vec3 fvDirHalfVector = normalize( fvDirVector + viewPosition );","        float fvDirDotNormalHalf = max( dot( normal, fvDirHalfVector ), 0.0 );","        float fvDirSpecularWeight = max( pow( fvDirDotNormalHalf, fShininess ), 0.0 );","        #ifdef USE_SPECULAR_TEXTURE","            fvDirSpecular += texture2D(fvSpecular,vTexcoord).xyz * fvDirDiffuseWeight * fvDirSpecularWeight * uDirectionalLightColor[i];","        #else","            fvDirSpecular += fvSpecular.xyz * fvDirDiffuseWeight * fvDirSpecularWeight * uDirectionalLightColor[i];","        #endif","    }","    fvTotalDiffuse.xyz += fvDirDiffuse.xyz;","    fvTotalSpecular.xyz += fvDirSpecular.xyz;","#endif","#if MAX_SPOT_LIGHTS > 0","#endif","vec3 cTotalAmbientLightColor = vec3( 0.0 );","#if MAX_AMBIENT_LIGHTS > 0","   for ( int i = 0; i < MAX_AMBIENT_LIGHTS; i ++ ) {","       cTotalAmbientLightColor += uAmbientLightColor[i];","   }","#endif","#ifdef USE_AMBIENT_TEXTURE","    vec4 fvTotalAmbient = texture2D(fvAmbient,vTexcoord) * vec4(cTotalAmbientLightColor,fTransparency);","#else","    vec4 fvTotalAmbient = fvAmbient  * vec4(cTotalAmbientLightColor,fTransparency);","#endif","#ifdef USE_EMISSION_TEXTURE","    vec4 fvTotalEmission = texture2D(fvEmission,vTexcoord);","#else","    vec4 fvTotalEmission = fvEmission;","#endif","gl_FragColor = ( fvTotalAmbient + fvTotalEmission + fvTotalDiffuse + fvTotalSpecular );"].join("\n")},uniformsLibrary:{gui_vertex:{uGuiMatrix:{type:"m4",value:0},uOrthographicMatrix:{type:"m4",value:0}},gui_fragment:{fvColor:{type:"t_c",value:0}},common_vertex:{uLookAt:{type:"m4",value:0},uPerspectiveMatrix:{type:"m4",value:0},uModelWorldMatrix:{type:"m4",value:0},uModelViewMatrix:{type:"m4",value:0}},phong:{fvDiffuse:{type:"t_c",value:0},fvAmbient:{type:"t_c",value:0},fvEmission:{type:"t_c",value:0},fvSpecular:{type:"t_c",value:0},fShininess:{type:"f",value:0}},light:{pointLight:{uPointLightColor:{type:"v3",value:0},uPointLightPosition:{type:"v3",value:0},uPointLightDistance:{type:"f",value:0},uPointLightQuadraticAttenuation:{type:"f",value:0},uPointLightLinearAttenuation:{type:"f",value:0},uPointLightConstantAttenuation:{type:"f",value:0}},spotLight:{uSpotLightColor:{type:"v3",value:0},uSpotLightPosition:{type:"v3",value:0},uSpotLightDistance:{type:"f",value:0},uSpotLightConstantAttenuation:{type:"f",value:0},uSpotLightLinearAttenuation:{type:"f",value:0},uSpotLightQuadraticAttenuation:{type:"f",value:0},uSpotLightFalloffAngle:{type:"f",value:0},uSpotLightFalloffExponent:{type:"f",value:0}},directionalLight:{uDirectionalLightDirection:{type:"v3",value:0},uDirectionalLightColor:{type:"v3",value:0}},ambientLight:{uAmbientLightColor:{type:"v3",value:0}}},fog:{}},defineLibrary:{gui_vertex:{USE_TEXTURE:{type:"b",value:i}},common_vertex:{USE_TEXTURE:{type:"b",value:i}},light:{MAX_SPOT_LIGHTS:{type:"i",value:0},MAX_POINT_LIGHTS:{type:"i",value:0},MAX_DIR_LIGHTS:{type:"i",value:0},MAX_AMBIENT_LIGHTS:{type:"i",value:0}},phong:{USE_SPECULAR_TEXTURE:{type:"b",value:i},USE_DIFFUSE_TEXTURE:{type:"b",value:i},USE_AMBIENT_TEXTURE:{type:"b",value:i},USE_EMISSION_TEXTURE:{type:"b",value:i}}},attributeLibrary:{gui_vertex:{aTextureCoord:{type:"v2",value:0},aVertex:{type:"v3",value:0}},common_vertex:{aTextureCoord:{type:"v2",value:0},aVertex:{type:"v3",value:0},aNormal:{type:"v3",value:0}}},getDefinition:function(e,t){var i=[],a=0;for(var r in t)this.defineLibrary[e][r]&&("b"===this.defineLibrary[e][r].type?t[r]&&(i[a]="#define "+r+" "+t[r]+"\n",a+=1):"i"===this.defineLibrary[e][r].type&&(i[a]="#define "+r+" "+t[r]+"\n",a+=1));return i.join("\n")},createVertexShaderSource:function(e,i){var a=[];return i?(a=[this.getDefinition("gui_vertex",e),this.shaderSnippets.gui_pars_vertex,"void main(void) {",this.shaderSnippets.gui_vertex,"}"],a.join("\n")):(a=[this.getDefinition("common_vertex",e),this.shaderSnippets.pars_vertex,this.shaderSnippets.transpose_function,this.shaderSnippets.inverse_function,"void main(void) {",this.shaderSnippets.vertex,"}"],t.info("shader"),a.join("\n"))},createFragmentShaderSource:function(e,t,i,a){var r=[];return r=a?[this.getDefinition("gui_vertex",t),this.shaderSnippets.gui_pars_fragment,"void main(void){",this.shaderSnippets.gui_fragment,"}"].join("\n"):[this.getDefinition(e,t),this.getDefinition("light",i),this.shaderSnippets[e+"_pars_fragment"],this.shaderSnippets.transpose_function,this.shaderSnippets.inverse_function,"void main(void){",this.shaderSnippets[e+"_fragment"],"}"].join("\n")},createAttribute:function(t,i){var a={};for(var r in this.attributeLibrary[t])a[r]={location:e.gl.getAttribLocation(i,r),type:this.attributeLibrary[t][r].type,defaults:this.attributeLibrary[t][r].value};return a},createUniforms:function(t,i,a,r){var n={};for(var o in this.uniformsLibrary[t])n[t]||(n[t]={}),n[t][o]={location:e.gl.getUniformLocation(a,o),type:this.uniformsLibrary[t][o].type,defaults:this.uniformsLibrary[t][o].value};if(!r){for(var s in this.uniformsLibrary[i])n[i]||(n[i]={}),n[i][s]={location:e.gl.getUniformLocation(a,s),type:this.uniformsLibrary[i][s].type,defaults:this.uniformsLibrary[i][s].value};n.light={};for(var l in this.uniformsLibrary.light){n.light[l]||(n.light[l]={});for(var c in this.uniformsLibrary.light[l])n.light[c]={location:e.gl.getUniformLocation(a,c),type:this.uniformsLibrary.light[l][c].type,defaults:this.uniformsLibrary.light[l][c].value}}}return n},updateShader:function(e){t.log(e)},updateAllShaders:function(){var i=[];for(var a in this.shaders)i[a]=this.shaders[a].options,e.gl.deleteProgram(this.shaders[a].shaderProgram);this.shaders=[];for(var r=0;i.length>r;r++)a=this.createShader(i[r]),a!==r&&t.log("some key problems")},getShaderProgramKey:function(e){var t=-1;for(var i in this.shaders)if(e.fragmentType===this.shaders[i].type){if(e.USE_TEXTURE===this.shaders[i].options.USE_TEXTURE){t=parseInt(i,10);break}if(this.shaders[i].options.USE_TEXTURES.USE_SPECULAR_TEXTURE===e.USE_TEXTURES.USE_SPECULAR_TEXTURE&&this.shaders[i].options.USE_TEXTURES.USE_DIFFUSE_TEXTURE===e.USE_TEXTURES.USE_DIFFUSE_TEXTURE&&this.shaders[i].options.USE_TEXTURES.USE_AMBIENT_TEXTURE===e.USE_TEXTURES.USE_AMBIENT_TEXTURE&&this.shaders[i].options.USE_TEXTURES.USE_EMISSION_TEXTURE===e.USE_TEXTURES.USE_EMISSION_TEXTURE){t=parseInt(i,10);break}}return-1===t&&(t=this.createShader(e)),t},createShader:function(i){var a=!1;"gui"===i.fragmentType&&(a=!0);var r=this.getShaderSource(i,a),n=e.gl.createProgram();t.info("glQuery.gl.attachShader(shaderProgram, shader.XVertex);"),e.gl.attachShader(n,r.XVertex),t.info("glQuery.gl.attachShader(shaderProgram, shader.XFragment);"),e.gl.attachShader(n,r.XFragment),e.gl.linkProgram(n),e.gl.getProgramParameter(n,e.gl.LINK_STATUS)||window.alert("Could not initialise shaders");var o=this.shaders.length;return this.shaders[o]={shaderProgram:n,shader:r,uniforms:this.createUniforms("common_vertex",i.fragmentType,n),attribute:this.createAttribute("common_vertex",n),options:i,type:i.fragmentType},o},getShaderSource:function(i,a){var r={};return t.time("glQuery.shader.getShaderSource()"),r.XFragment=e.gl.createShader(e.gl.FRAGMENT_SHADER),r.XVertex=e.gl.createShader(e.gl.VERTEX_SHADER),a&&(i.USE_TEXTURES={USE_TEXTURE:i.USE_TEXTURE}),e.gl.shaderSource(r.XFragment,e.shader.createFragmentShaderSource(i.fragmentType,i.USE_TEXTURES,e.light.shaderLight,a)),e.gl.compileShader(r.XFragment),e.gl.getShaderParameter(r.XFragment,e.gl.COMPILE_STATUS)?(e.gl.shaderSource(r.XVertex,e.shader.createVertexShaderSource({USE_TEXTURE:i.USE_TEXTURE},a)),e.gl.compileShader(r.XVertex),e.gl.getShaderParameter(r.XVertex,e.gl.COMPILE_STATUS)?(t.timeEnd("glQuery.shader.getShaderSource()"),r):(t.log(e.gl.getShaderInfoLog(r.XVertex)),!1)):(t.log(e.gl.getShaderInfoLog(r.XFragment)),!1)},shaders:[]}}(glQuery,window.console),function(e,t){e.webGL={createWebGL:function(t){if(e.progressBarStep("createwebgl",2),!t){var i=this.initWebGL();if(!i)return!1}return e.gl.clearColor(1,1,1,1),e.gl.viewport(0,0,e.canvasWidth,e.canvasHeight),e.gl.clearDepth(1),e.gl.enable(e.gl.DEPTH_TEST),e.gl.depthFunc(e.gl.LEQUAL),e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.progressBarStep("createwebgl",8),!0},initWebGL:function(){var i=e.options.id;i=document.getElementById(i);var a=["webgl","experimental-webgl","webkit-3d","moz-webgl"];e.gl=null;for(var r=0;a.length>r;++r){try{e.gl=i.getContext(a[r])}catch(n){}if(e.gl)break}return e.gl?(e.options.debug&&(e.gl=t.makeDebugContext(e.gl)),!0):!1},createScene:function(){},options:{fog:!1}}}(glQuery,WebGLDebugUtils);